# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Commands

### Development

- `bun run dev` - Start both frontend and backend development servers
- `bun run dev:frontend` - Start only frontend development server (uses pnpm exec vite)
- `bun run dev:backend` - Start only backend development server (bun --watch)

### Package Management

- `pnpm install` - Install dependencies (primary package manager)
- `pnpm install -D <package>` - Add dev dependencies
- `pnpm install <package>` - Add production dependencies
- `bun install` - Only use for installing existing dependencies (not adding new ones)

### Building

- `bun run build` - Full production build (OG images + frontend + backend)
- `bun run build:og` - Generate Open Graph images only
- `bun run start` - Start production server (bun dist/backend/index.js)

### Testing

- `bun run test` - Run all tests once
- `bun run test:watch` - Run tests in watch mode
- `vitest run src/frontend/composables/useSEO.test.ts` - Run specific test file

### Code Quality

- `pnpm run lint` - Run ESLint
- `pnpm run lint:fix` - Fix linting issues automatically
- `pnpm run format` - Format code with Prettier
- `pnpm run type-check` - TypeScript check for backend
- `pnpm run type-check:vue` - TypeScript check for Vue frontend
- `pnpm run check:all` - Run all quality checks (format, lint, type-check, i18n audit)

### i18n

- `bun run i18n:audit` - Check translation completeness and consistency

### Component Development

- `bun run histoire` - Start Histoire for component development/testing

## Architecture Overview

### Hybrid Package Management

- **Primary**: pnpm (for adding/managing dependencies)
- **Secondary**: bun (for backend runtime and scripts only)
- Frontend tooling (Vite, Vue) uses pnpm
- Backend runtime and custom scripts use bun

### Monolithic Structure

Vue 3 + TypeScript frontend with Bun + Hono backend in single repository. Uses file-based routing with `unplugin-vue-router`.

### Frontend (src/frontend/)

- **Framework**: Vue 3 with Composition API + TypeScript
- **Build Tool**: Vite with vite-ssg for static site generation
- **Routing**: File-based routing via `unplugin-vue-router` (pages/ directory becomes routes)
- **State**: Pinia with persistence plugin
- **i18n**: Vue i18n with namespaced JSON files (en/, de/ locales)
- **Styling**: Tailwind CSS with custom design system
- **Components**: Auto-imported from components/ directory with nested namespace support

### Backend (src/backend/)

- **Runtime**: Bun
- **Framework**: Hono (TypeScript web framework)
- **Architecture**: API routes + static file serving
- **Logging**: Custom logger service with structured logging

### Key Architectural Patterns

#### SEO System

- `useSEO()` composable handles all meta tags, Open Graph, Twitter Cards, JSON-LD
- Automatic OG image path generation based on route names
- Images generated by `scripts/generate-og-images.ts` during build

#### i18n System

- Namespaced translation files: `locales/{lang}/{namespace}.json`
- All new translation files must be registered in `main.ts`
- Use `{{ t('namespace.key') }}` in templates, `t('namespace.key')` in composables

#### Component System

- Design system components in `components/rd/` with story files
- UI library components in `components/ui/` (shadcn-vue style)
- Auto-import with directory-based namespacing: `<RdBaseButton>` from `rd/Base/Button/`

#### File-Based Routing

- Pages in `src/frontend/pages/` automatically become routes
- `pages/about/index.vue` → `/about` route
- `pages/legal/privacy.vue` → `/legal/privacy` route

### Environment Configuration

- Frontend uses `VITE_SITE_URL` for absolute URLs in SEO
- Backend port configurable via `PORT` environment variable
- CORS configured for local development ports (5173-5175)

### Build Process

1. Generate OG images (`build:og` - uses bun)
2. Build frontend with Vite (uses pnpm)
3. Build backend with Bun to `dist/backend/`

### Testing Setup

- Vitest for both frontend and backend
- Frontend tests use jsdom environment
- Backend tests use node environment
- Setup file: `src/frontend/vitest.setup.ts`
